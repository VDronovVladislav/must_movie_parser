# Парсер фильмов MustApp 
### Парсер реализует два функционала:
1. Парсит просмотренные фильмы и создает из них базу данных для проекта киносоревнования https://github.com/VDronovVladislav/best_movie
 *Детали функционала:* Предназначен для сайта mustapp.com и парсит просмотренные пользователями фильмы, после чего создает БД из фильмов, которые были просмотрены всеми участниками без исключения (т.е в итоговой БД не будет фильма, который не смотрел хотя бы один из участников, для которого проводился парсинг).
 
2. Парсит данные из разделов  "Посмотрю,  "Просмотрены" и "Сериалы" и добавляет их в ваш новый аккаунт (функционал предназначен для тех, у кого больше нет доступа в старый аккаунт Must).
 *Детали функционала:* Функционал реализован для пользователей, кто по какой-то причине больше не может зайти в свой аккаунт Must, но хочет продолжать пользоваться сервисом и не добавлять все просмотренные фильмы и сериалы для нового аккаунта вручную.

## Cтек:

SQLAlchemy, aiohttp, requests, asyncio, argparse, tqdm.

## Инструкция по запуску:

Клонировать репозиторий и перейти в него в командной строке:
```
git clone https://github.com/VDronovVladislav/must_movie_parser
```
```
cd must_movie_parser
```
Cоздать и активировать виртуальное окружение:
```
python3 -m venv venv
```
* Если у вас Linux/macOS
```
source venv/bin/activate
```
* Если у вас windows
```
source venv/Scripts/activate
```
Установить зависимости из файла requirements.txt:
```
python3 -m pip install --upgrade pip
```
```
pip install -r requirements.txt
```

## Инструкция по работе с парсером:
Создать в главной директории проекта файл ```.env``` и заполнить его по примеру с файлом ```.env_example``` вашими данными:
```
# Константы, необходимые для режимов must_want/must_watched/must_shows:
MUST_TOKEN=43tsdvf4s4s4tsg4tgs4 # Токен пользователя, для которого добавляем данные.
USER_ID=999777 # ID пользователя, для которого добавляем данные.
USER_TO_PARSE=@Username # Username пользователя в Must, чьи данные парсим.

# Константа для режима must_db_create:
USERS_NAMES=@Username1,@Username2 # Username пользователей через запятую, из чьих фильмов делаем БД.
```
#### Где взять небходимые константы:
**MUST_TOKEN** - Залогиниться под вашим пользователем на сайте mustapp.com, открыть DevTools браузера и отправить любой запрос на добавление любого фильма (например, добавить фильм в просмотренные). Нужный токен будет в Request Headers под ключом **bearer**.
**USER_ID** - При отправке запроса ваш user_id будет в Request URL. В данном примере запроса user_id выделен жирным шрифтом `https://mustapp.com/api/users/id/**866527**/products/11000814
**USER_TO_PARSE** - Это Username вашего аккаунта, к которому утерян доступ. Как раз с него мы и будем переносить данные.

Вышеуказанные константы необходимы для режимов *must_want/must_watched/must_shows*.

**USERS_NAMES** - Это Username пользователей, из чьих фильмов вы хотите сделать базу данных для киносоревнования. Данная константа необходима для режима *must_db_create*.

#### Описание режимов:

- Режим **must_want** - добавление в новый аккаунт всех фильмов из старого аккаунта из раздела "Посмотрю".
- Режим **must_watched** - добавление в новый аккаунт всех фильмов из старого аккаунта из раздела "Просмотрены".
- Режим **must_shows** - добавление в новый аккаунт всех фильмов из старого аккаунта из раздела "Сериалы".
- Режим **must_db_create** - создает файл db.sqlite3 с просмотренными фильмами для пользователей, указанных в **USERS_NAMES**. Перенесите этот файл в папку ```/best_movie_app``` проекта **best_movie** и можно играть.

#### Запуск режимов:
В главной директории проекта в терминале командной строки введите ```python main.py <название режима>```. 
Пример ```python main.py must_want```

При запуске режима ```python main.py must_db_create``` он также принимает **необязательный** аргумент **rating** - это рейтинг, ниже которого не будут добавлены фильмы при создании базы.
Пример: ```python main.py must_db_create -r 8``` - база будет создана только из просмотренных фильмов, которые всеми участниками были оценены на 8 и выше.
```python main.py must_db_create``` - без указания аргумента база будет создана из фильмов, просмотренных всеми участниками вне зависимости от их рейтинга.